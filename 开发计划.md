# 项目开发计划 (MVP优先原则)

本文档遵循MVP（Minimum Viable Product，最小可行产品）优先的原则，旨在快速迭代，尽早交付核心价值。

## 0. 准备阶段：环境与基础设置

*   **任务0.1**: 确认并搭建基础项目目录结构。 - **【已完成】**
    *   参考已讨论的目录结构（包含`backend/`, `frontend/`, `需求文档.md`, `.cursorrules.json`, `.gitignore`, `README.md`等）。
*   **任务0.2**: 初始化Git版本控制。 - **【已完成】**
*   **任务0.3**: 确定并搭建后端技术栈（初步选型：Python + Flask）。 - **【已完成】**
    *   创建虚拟环境 (`venv`)。 - **【已完成】**
    *   安装Flask等基础依赖 (`requests`, `Flask`) (`backend/requirements.txt`)。 - **【已完成】**
*   **任务0.4**: 确定前端技术栈（HTML, CSS, Vanilla JavaScript）。 - **【已完成】**

## 1. MVP阶段：核心功能实现

**MVP目标：** 用户能够输入文本，选择生成图片或语音，并看到/听到生成的结果，允许下载语音。 - **【已基本达成】**

### 1.1 后端：Pollinations API 交互与核心API
*   **任务1.1.1**: 实现 Pollinations API 交互模块 (`backend/pollinations_api_handler.py`) - **【已完成】**
    *   功能：使用合适的HTTP客户端库（Python的`requests`）与 Pollinations.AI 的公开API端点进行通信。 - **【已完成】**
    *   功能：根据用户输入和选择的生成类型（图片/语音），构造并发送HTTPS请求到相应的Pollinations API端点。 - **【已完成】**
    *   功能：能够接收并处理Pollinations API返回的HTTP响应，包括图片数据（base64编码），音频数据（保存为文件后提供URL）。 - **【已完成】**
    *   功能：基本的错误处理（如网络请求失败、API返回错误状态码如4xx/5xx等）。- **【已部分实现，可后续增强】**
    *   *产出*：一个可以被后端API调用的、能与Pollinations公开API稳定通信的Python模块。 - **【已完成】**
*   **任务1.1.2**: 实现统一的生成API (`/api/generate`) - **【已完成】** (合并原图像和音频API为一个)
    *   功能：接收前端POST请求，包含用户输入的文本和生成类型。 - **【已完成】**
    *   功能：调用 `pollinations_api_handler` 执行图片或音频生成请求。 - **【已完成】**
    *   功能：将API返回的图片数据（base64字符串）或音频URL以JSON格式返回给前端。 - **【已完成】**
    *   功能：最基本的错误处理。- **【已部分实现，可后续增强】**

### 1.2 前端：用户界面与交互
*   **任务1.2.1**: 搭建基础HTML页面 (`frontend/index.html`) - **【已完成】**
    *   包含：一个文本输入框 (`<textarea>`)。 - **【已完成】**
    *   包含：一组单选按钮用于选择"图片"或"语音"。 - **【已完成】**
    *   包含：一个"生成"按钮 (`<button>`)。 - **【已完成】**
    *   包含：一个用于显示图片的结果区域 (`<img>`标签)。 - **【已完成】**
    *   包含：一个用于音频播放和下载的区域（一个`<audio>`控件和一个下载链接`<a>`）。 - **【已完成】**
*   **任务1.2.2**: 实现基础CSS样式 (`frontend/styles.css`) - **【已完成】**
    *   保证页面元素基本可用、不混乱即可，无需精美设计。 - **【已完成】**
*   **任务1.2.3**: 实现前端核心JavaScript逻辑 (`frontend/script.js`) - **【已完成】**
    *   功能：获取用户输入的文本和选择的生成类型。 - **【已完成】**
    *   功能：当点击"生成"按钮时，根据选择的类型，异步调用后端的`/api/generate`接口 (使用`fetch` API)。 - **【已完成】**
    *   功能：处理图片生成的响应：将返回的base64字符串设置为`<img>`的`src`属性以显示图片。 - **【已完成】**
    *   功能：处理语音生成的响应：将返回的音频URL设置为`<audio>`控件的`src`并使下载链接指向该URL。 - **【已完成】**
    *   功能：实现最基本的加载状态提示（按钮文字改变为"生成中..."）。 - **【已完成】**
    *   功能：实现最基本的前端错误提示（如`alert()`一个简单的错误信息）。 - **【已完成】**

**MVP验收标准：** - **【已达成】**
1.  用户可以在网页上输入文字。 - **【已达成】**
2.  用户可以选择生成图片或语音。 - **【已达成】**
3.  点击生成后：
    *   如果选择图片，网页能显示生成的图片。 - **【已达成】**
    *   如果选择语音，网页能提供播放器播放语音，并提供下载链接下载音频文件。 - **【已达成】**
4.  整个流程基本跑通，允许偶尔出现简单错误提示下的失败。 - **【已达成】**

## 2. 迭代一：易用性与健壮性增强

*   **任务2.1**: 完善用户界面与体验 (UI/UX)。
    *   改进加载指示器（例如使用更美观的loading动画）。
    *   优化结果展示区域的布局和样式。
    *   使页面在不同屏幕尺寸下有基本的响应式表现。
*   **任务2.2**: 增强后端错误处理与日志。
    *   `pollinations_api_handler.py`：更细致地捕获和处理API的各类错误（超时、错误码、无效输出等）。
    *   API层面：返回更规范、详细的错误信息给前端。
    *   引入简单的后端日志记录（记录API调用情况和关键错误）。
*   **任务2.3**: 增强前端错误处理与用户反馈。
    *   使用更友好的方式向用户展示错误信息（例如在页面特定区域显示，而不是`alert()`）。
    *   处理网络请求错误、API返回的业务错误等。
*   **任务2.4**: 代码规范与注释。
    *   根据`.cursorrules.json`全面检查并添加详细的中文注释。
    *   整理代码结构，提高可读性。

## 3. 迭代二：优化与文档完善

*   **任务3.1**: 性能优化（视情况而定）。
    *   评估 Pollinations API 调用的耗时，关注网络延迟、请求与响应处理时间。
    *   考虑API是否有速率限制，并实现相应的重试或用户提示逻辑。
    *   前端资源加载优化。
*   **任务3.2**: 安全性加固（基础）。
    *   对用户输入进行更严格的校验和清理（后端）。
    *   检查并防范常见的Web安全风险（如XSS的基础防范）。
*   **任务3.3**: 完善项目文档。 - **【部分完成】**
    *   更新 `README.md`：包含详细的安装、配置、启动步骤，API说明（如果前端开发者需要）。
    *   确保 `需求文档.md` 与最终实现一致。
*   **任务3.4**: 跨浏览器兼容性测试与调整。
    *   在主流浏览器（Chrome, Firefox, Edge）上进行测试并修复兼容性问题。

## 4. 后续迭代 (可选/未来考虑)

*   用户账户系统与历史记录。
*   高级参数调整（模型选择、图片风格、语音音色等）。
*   异步任务队列处理耗时生成（如果API调用非常慢）。
*   更美观的UI设计。

---
**注：** 此计划会根据实际开发进度和遇到的问题动态调整。每次调整后，本文档将被更新。所有代码和命令将优先考虑Windows平台的兼容性。

## 当前状态总结 (截至2025-05-16)

项目已成功完成MVP（最小可行产品）的核心功能开发。具体如下：

1.  **后端 (Python/Flask)**:
    *   成功搭建并运行Flask服务。
    *   实现了与Pollinations.AI公开HTTP API的对接模块 (`pollinations_api_handler.py`)，用于生成图像和音频。
    *   提供了统一的 `/api/generate` 端点，根据请求类型（图像/音频）调用相应处理逻辑。
    *   图像以Base64字符串形式返回，音频保存至服务器后返回下载URL。
    *   基础依赖已通过 `backend/requirements.txt` 管理。

2.  **前端 (HTML/CSS/JS)**:
    *   `frontend/index.html`: 包含文本输入、类型选择（图像/音频）、生成按钮及结果展示区。
    *   `frontend/script.js`: 实现与后端API的异步交互，根据响应动态展示图片或提供音频播放/下载。
    *   `frontend/styles.css`: 提供了基本页面样式。

3.  **核心流程**:
    *   用户在前端输入文本，选择生成类型，点击生成。
    *   前端发送请求至后端Flask服务。
    *   后端调用Pollinations.AI的API进行处理。
    *   后端将结果（图片Base64或音频URL）返回给前端。
    *   前端展示图片或提供音频播放与下载。
    *   整个图文生成和音文生成的核心流程已跑通并验证成功。

**后续方向**:
*   迭代一中的易用性与健壮性增强。
*   完善错误处理和用户反馈。
*   文档更新。
*   代码规范和注释。
(请将 YYYY-MM-DD 替换为当前日期) 