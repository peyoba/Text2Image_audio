# Requirements Document

> For project overview, deployment, progress, and status, please refer to README.md. This document only details functional requirements and user experience.

## 1. 引言

### 1.1 项目目标
创建一个Web应用程序，允许用户输入文本，并通过调用 Pollinations Multimodal MCP Server (以下简称MCP服务) 生成相应的图片或语音。

### 1.2 项目范围
**包含功能:**
*   用户输入文本。
*   选择生成类型：图片或语音。
*   调用MCP服务执行生成任务。
*   在网页上直接显示生成的图片。
*   提供生成的语音播放及下载功能。
*   使用MCP服务的默认模型进行内容生成。

**不包含功能 (初期版本):**
*   用户账户系统。
*   历史记录保存。
*   前端直接提供的高级参数调整（如图片风格、模型选择）。*注：部分参数如语音音色/语速已可通过后端环境变量配置。*
*   付费功能。

### 1.3 目标用户
对AI生成内容感兴趣的普通用户、内容创作者、开发者等，希望通过简单操作快速体验文生图和文生语音功能。

## 2. 总体描述

### 2.1 产品愿景
提供一个简洁、易用、高效的在线工具，让用户能够轻松将文本创意转换为视觉和听觉内容。

### 2.2 产品功能概述
1.  **文本输入**: 用户在指定区域输入描述性文本。
2.  **类型选择**: 用户选择希望生成图片还是语音。
3.  **内容生成**: 系统后端调用MCP服务处理用户请求。
4.  **图片展示**: 生成的图片直接在网页上渲染显示。
5.  **语音播放与下载**: 生成的语音可以在网页上播放，并提供下载选项。

## 3. 详细需求

### 3.1 用户界面 (UI) 需求

#### 3.1.1 主页面布局
*   简洁明了的单页应用设计。
*   主要包含：文本输入区、选项区、操作按钮、结果展示区。

#### 3.1.2 文本输入区
*   一个多行文本框，允许用户输入较长的描述性文本。
*   应有明确的提示文字，如"请输入您的描述文本..."。

#### 3.1.3 生成类型选择
*   提供清晰的选项供用户选择生成"图片"或"语音"。
*   可使用单选按钮组或下拉菜单实现。

#### 3.1.4 "生成"按钮
*   一个明确的按钮，如"开始生成"或"执行"。
*   点击后触发后端处理逻辑。

#### 3.1.5 结果展示区
*   **图片**:
    *   成功生成后，图片直接在此区域显示。
    *   图片应能适应区域大小，避免溢出。
*   **语音**:
    *   成功生成后，此区域出现一个HTML5音频播放器控件，用于播放在线生成的语音。
    *   播放器旁边提供一个"下载音频"按钮/链接。
*   初始状态下，结果区可以为空或显示提示信息。

#### 3.1.6 加载与状态提示
*   当用户点击"生成"按钮后，直到结果返回前，应有明确的加载指示（如加载动画、进度提示文本）。
*   例如："正在生成中，请稍候..."

#### 3.1.7 错误提示
*   如果MCP调用失败、输入无效或发生其他错误，应在界面上给出友好、清晰的错误提示信息。
*   例如："生成失败，请检查您的输入或稍后再试。"

### 3.2 功能需求

#### 3.2.1 文生图功能
*   **输入**: 用户在前端界面提供的文本描述。
*   **处理**:
    1.  前端将文本和"生成图片"的指令发送给后端。
    2.  后端服务构造符合MCP协议的指令，调用MCP服务的 `generateImage` 工具 (使用默认模型)。
    3.  MCP服务返回base64编码的图片数据。
    4.  后端将base64图片数据返回给前端。
*   **输出**: 前端接收到base64数据后，直接在结果展示区渲染图片。

#### 3.2.2 文生语音功能
*   **输入**: 用户在前端界面提供的文本描述。
*   **处理**:
    1.  前端将文本和"生成语音"的指令发送给后端。
    2.  后端服务构造符合MCP协议的指令，调用MCP服务的 `sayText` 工具 (使用默认模型)。
    3.  MCP服务返回音频数据（具体格式需在后端与MCP交互时确认，目标是能转换为可下载的文件格式，如MP3或WAV）。
    4.  后端处理音频数据，使其能够被前端播放，并准备一个可供下载的音频文件。
*   **输出**:
    *   前端结果展示区提供音频播放器。
    *   前端提供音频文件下载链接/按钮。

#### 3.2.3 Pollinations API 调用与结果处理
*   后端应用需要能够通过 HTTPS 协议与 Pollinations.AI 的公开 API 端点进行通信。
*   能够正确构造发送给 Pollinations API 的 HTTP 请求（包括正确的 URL、参数和请求体，如果需要）。
*   能够正确解析 Pollinations API 返回的 HTTP 响应（包括图片数据、音频数据或错误信息）。
*   处理网络请求错误、API 返回的错误状态码等。

### 3.3 非功能需求

#### 3.3.1 易用性
*   用户界面应简洁直观，操作流程简单易懂，无需复杂学习即可上手。

#### 3.3.2 响应性
*   对于MCP调用这类可能耗时的操作，前端必须提供即时的反馈和加载状态，避免用户感觉程序无响应。
*   尽可能优化后端处理，减少等待时间。

#### 3.3.3 错误处理
*   系统应能优雅处理各种预期和意外错误（如外部API服务不可用、返回错误、网络问题等）。
    *   **实现细节**: 后端对外部API的调用实现了**自动重试机制**（最多3次），以应对瞬时网络或服务抖动，提高了操作的成功率。
*   向用户提供有意义的错误提示，而不是原始的技术错误信息。
    *   **实现细节**: 后端对可预见的错误（如API密钥缺失）返回了**标准化的HTTP错误码和JSON错误体**，前端能够据此向用户显示精确、友好的错误信息。

#### 3.3.4 兼容性
*   Web前端应优先保证在最新版本的Chrome、Firefox、Edge等主流现代桌面浏览器上正常工作。

#### 3.3.5 安全性 (基本)
*   对用户输入进行基本的校验和清理，防止简单的注入风险。
*   **实现细节**: 敏感信息（如 `DEEPSEEK_API_KEY`）通过**环境变量**进行管理，避免了将密钥硬编码在代码中，增强了安全性。

## 4. Pollinations API 接口依赖 (基于 `pollinations_README.md` 及公开API)

Web应用后端将依赖 Pollinations.AI 提供的以下核心功能的公开 HTTP API 端点：

### 4.1 图片生成 API
*   **用途**: 根据文本提示生成图片。
*   **API端点示例**: `https://pollinations.ai/p/{prompt_text}` (具体参数如 `width`, `height`, `seed` 等可根据API文档添加)
*   **预期输入 (由后端发送给API)**: 构造包含文本提示的 HTTP GET 请求。
*   **预期输出 (由API返回给后端)**: 图片数据（例如，直接的JPEG/PNG二进制流，或特定响应头指示的内容）。

### 4.2 文本转语音 API
*   **用途**: 根据提供的文本生成语音。
*   **API端点示例**: `https://text.pollinations.ai/{text_to_speak}?model=openai-audio&voice={voice_name}` (具体参数需参考API文档)
*   **预期输入 (由后端发送给API)**: 构造包含要朗读文本及所需参数的 HTTP GET 请求。
*   **预期输出 (由API返回给后端)**: 音频数据。后端需要处理此数据，以支持前端播放和文件下载（如获取MP3/WAV数据流）。

### 4.3 通信机制
*   **传输方式**: HTTPS。
*   **数据格式**: 标准的 HTTP 请求和响应。响应体格式（如图片、音频）将由 API 定义。

## 5. 技术选型初步考虑 (建议)

*   **前端**:
    *   HTML, CSS, JavaScript。
    *   可考虑使用现代JavaScript框架/库 (如 Vue.js, React, Svelte) 以提高开发效率和可维护性，但纯JS也可实现。
*   **后端**:
    *   可选择 Node.js、Python (Flask/Django)、Go等。
    *   需要有执行出站 HTTPS 请求的能力，并能高效处理和转换 API 返回的数据（如图片和音频流）。
*   **Pollinations 服务**: Pollinations.AI 公开的 HTTP API。

## 6. 后续步骤
1.  **环境搭建**: 确保后端开发环境可以正常发起出站 HTTPS 请求，并能通过工具（如 Postman, curl）或代码片段成功测试对 Pollinations API 的基本调用。
2.  **后端开发**: 实现API接口，封装对 Pollinations 公共 API 的调用逻辑。
3.  **前端开发**: 构建用户界面，并与后端API对接。
4.  **集成测试**: 对整个流程进行测试。
5.  **部署**: 选择合适的部署方案。 